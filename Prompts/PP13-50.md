- IssueID = PP13-50
- Please read 'Prompts/BasePrompt.md' first for general context
- **Critical Bug**: During Doltâ†’ChromaDB synchronization, document fields are being swapped - specifically the document ID (`doc_id`) is being stored as ChromaDB document content, while the actual document content is being stored as the ChromaDB document ID. This causes incorrect data retrieval when using ChromaGetDocumentsTool.
- **Investigation Summary**: The bug was identified through investigation PP13-49-C1 where collection discovery was fixed but revealed this secondary data mapping issue. The ChromaGetDocumentsTool retrieval logic is correct - the problem occurs during the synchronization pipeline when data flows from Dolt to ChromaDB.
- **Root Cause Location**: The field swapping occurs in the sync pipeline between Dolt data extraction and ChromaDB insertion, specifically in one of these components:
  - `SyncManagerV2.cs` - Document transformation logic before ChromaDB insertion
  - `ChromaPythonService.cs` - The `AddDocumentsAsync` method where `doc_id` and `content` are mapped to ChromaDB parameters
  - Python ChromaDB integration layer - Parameters passed to ChromaDB's `add()` method
- **Evidence**:
  - Source data in Dolt: `doc_id=someid1, content="User A added a document"` (correct)
  - Retrieved data from ChromaDB: ID shows as "User A added a document", document content shows as "someid1" (swapped)
  - Log shows successful sync: `Added 1 documents to collection 'main'` but with incorrect field mapping
- **Assignment Scope**:
  1. **Identify the exact location** where the field swapping occurs in the sync pipeline by examining:
     - `SyncManagerV2.cs` - Document transformation/preparation logic
     - `ChromaPythonService.cs` - `AddDocumentsAsync` method and ChromaDB parameter mapping
     - Python integration code that calls ChromaDB's `add()` method
  2. **Fix the field mapping** to ensure:
     - Dolt `doc_id` field maps correctly to ChromaDB `ids` parameter
     - Dolt `content` field maps correctly to ChromaDB `documents` parameter
     - Metadata fields are preserved correctly
  3. **Verify the fix** by:
     - Running a test sync operation from Dolt to ChromaDB
     - Using ChromaGetDocumentsTool to retrieve documents
     - Confirming that document IDs and content are correctly mapped
  4. **Ensure no regression** in:
     - Collection discovery functionality (fixed in PP13-49-C1)
     - Other sync operations and metadata handling
     - Existing tests and functionality
- **Test Data Location**: 
  - Dolt repository: `D:\Prespective\352327_DMMSReceive\data\dev\dolt-repo\`
  - Source documents CSV: `doltdump\documents.csv`
  - Expected data: `doc_id=someid1, content="User A added a document"`
- **Success Criteria**:
  - ChromaGetDocumentsTool returns documents with correct field mapping: ID="someid1", document="User A added a document"
  - No change in collection discovery functionality
  - Logs show successful sync with correct data mapping
  - All existing functionality remains intact