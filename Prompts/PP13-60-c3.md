- IssueID = PP13-60-c3
- Please read 'Prompts/BasePrompt.md' first for general context
- This assignment addresses critical service dependency issues in the EmptyRepositoryFallbackIssuesTests that prevent proper integration testing of the empty repository fallback mechanism

## Background Context

The PP13-60-c2 assignment successfully fixed the deletion tracking functionality in UpdateDeleteSyncBasicTests, but revealed that the older EmptyRepositoryFallbackIssuesTests are failing due to incomplete dependency injection setup. These tests are designed to validate critical fallback scenarios when cloning empty repositories from DoltHub.

## Problem Analysis

Investigation revealed that all EmptyRepositoryFallbackIssuesTests fail during service provider setup with the error:
**"Unable to resolve service for type 'DMMS.Services.IDeletionTracker'"**

### Root Cause: Missing Service Dependencies

The test setup in `EmptyRepositoryFallbackIssuesTests.cs` has incomplete dependency injection configuration:

1. **Missing IDeletionTracker Service**: 
   - `SyncManagerV2` constructor requires `IDeletionTracker deletionTracker`
   - Test only registers: `IDoltCli`, `IChromaDbService`, `ISyncManagerV2`, and MCP tools
   - **Missing**: `IDeletionTracker` registration

2. **Service Type Mismatch**:
   - Tests register `IChromaDbService` with `ChromaPersistentDbService` implementation
   - Working tests use `ChromaDbService` instead, causing potential behavior incompatibility

3. **Missing Supporting Services**:
   - `SqliteDeletionTracker` requires `ServerConfiguration` for database path setup
   - Missing transitive dependency configurations

### Error Flow:
1. Test calls `GetRequiredService<ISyncManagerV2>()`
2. DI container tries to create `SyncManagerV2`
3. Constructor requires `IDeletionTracker`
4. No registration found â†’ **Exception thrown**

## Assignment Tasks

### Task 1: Fix Service Dependencies
Update the `Setup()` method in `EmptyRepositoryFallbackIssuesTests.cs` to include all required service registrations:

```csharp
// Add missing service registrations similar to UpdateDeleteSyncBasicTests
services.AddSingleton<IDeletionTracker, SqliteDeletionTracker>();
services.AddSingleton<ServerConfiguration>(/* proper configuration */);
services.Configure<ServerConfiguration>(/* options configuration */);
```

### Task 2: Align Service Types
- Replace `ChromaPersistentDbService` with `ChromaDbService` to match working test patterns
- Ensure consistent service registration patterns across all integration tests

### Task 3: Complete Dependency Chain
- Verify all transitive dependencies for `SqliteDeletionTracker` are properly configured
- Ensure `ServerConfiguration` includes proper path handling for deletion tracking database
- Match the dependency injection pattern from `UpdateDeleteSyncBasicTests`

### Task 4: Validate Configuration
- Ensure `ServerConfiguration` and `DoltConfiguration` are properly aligned
- Verify database paths don't conflict between different test configurations
- Test isolation should be maintained with unique temporary directories

### Task 5: Test Validation
- Run all EmptyRepositoryFallbackIssuesTests to ensure they pass
- Verify that the tests actually execute their intended functionality (not just pass setup)
- Validate that the fallback scenarios are properly tested:
  - Remote configuration persistence
  - Schema table creation
  - Working directory consistency
  - ChromaDB-Dolt sync functionality
  - Push operation after fallback

## Expected Outcomes

1. **All EmptyRepositoryFallbackIssuesTests pass**: Service dependency errors resolved
2. **Test functionality validated**: Tests execute intended scenarios rather than failing at setup
3. **Service consistency**: Alignment with working test patterns in UpdateDeleteSyncBasicTests
4. **Fallback validation**: Proper testing of empty repository clone fallback mechanisms

## Success Criteria

- Zero service dependency resolution errors during test setup
- All 6 test methods in EmptyRepositoryFallbackIssuesTests execute successfully
- Service registration patterns consistent with working integration tests
- Fallback scenarios properly validated without infrastructure failures

## Notes

- This is a **configuration/setup issue**, not a functional bug in application code
- The underlying features being tested are likely working correctly
- Focus on dependency injection completeness rather than business logic changes
- Maintain test isolation and cleanup patterns established in working tests